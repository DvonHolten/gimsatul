CC=@CC@
CFLAGS=@CFLAGS@

SRC=$(sort $(wildcard *.c))
OBJ=$(SRC:.c=.o)
DEP=$(filter-out config.h,$(wildcard *.h)) makefile

%.o: %.c $(DEP)
	$(CC) $(CFLAGS) -c $<

all: gimsatul
gimsatul: $(OBJ) makefile
	$(CC) $(CFLAGS) -o $@ $(OBJ) -lm -pthread

gimsatul.o: config.h
config.h: makefile VERSION
	./mkconfig.sh > $@

clean:
	rm -f makfile config.h *.o gimsatul *~ *.backup
indent:
	indent gimsatul.c
test: all
	cnf/test.sh
docker: clean
	docker build -t gimsatul .

.PHONY: all clean docker indent test
